<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Android-CustomView  Canvas · dangxy99的Blog</title><meta name="description" content="Android-CustomView  Canvas - dangxy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="dangxy99的Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/dangxy" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Android-CustomView  Canvas</h1><div class="post-info">Jun 12, 2019</div><div class="post-content"><h3 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h3><p>Canvas我们可以称之为画布，能够在上面绘制各种东西，是安卓平台2D图形绘制的基础，非常强大。</p>
<a id="more"></a>
<ol>
<li><p>绘制颜色    drawColor, drawRGB, drawARGB    使用单一颜色填充整个画布</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawColor(Color.BLUE); <span class="comment">//绘制蓝色</span></div></pre></td></tr></table></figure>
</li>
<li><p>绘制基本形状    drawPoint, drawPoints, drawLine, drawLines, drawRect, drawRoundRect, drawOval, drawCircle, drawArc    依次为 点、线、矩形、圆角矩形、椭圆、圆、圆弧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">canvas.drawPoint(<span class="number">200</span>, <span class="number">200</span>, mPaint);     <span class="comment">//在坐标(200,200)位置绘制一个点</span></div><div class="line">canvas.drawPoints(<span class="keyword">new</span> <span class="keyword">float</span>[]&#123;          <span class="comment">//绘制一组点，坐标位置由float数组指定</span></div><div class="line">      <span class="number">500</span>,<span class="number">500</span>,</div><div class="line">      <span class="number">500</span>,<span class="number">600</span>,</div><div class="line">      <span class="number">500</span>,<span class="number">700</span></div><div class="line">&#125;,mPaint);</div><div class="line"></div><div class="line">canvas.drawLine(<span class="number">300</span>,<span class="number">300</span>,<span class="number">500</span>,<span class="number">600</span>,mPaint);    <span class="comment">// 在坐标(300,300)(500,600)之间绘制一条直线</span></div><div class="line">canvas.drawLines(<span class="keyword">new</span> <span class="keyword">float</span>[]&#123;               <span class="comment">// 绘制一组线 每四数字(两个点的坐标)确定一条线</span></div><div class="line">    <span class="number">100</span>,<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>,</div><div class="line">    <span class="number">100</span>,<span class="number">300</span>,<span class="number">200</span>,<span class="number">300</span></div><div class="line">&#125;,mPaint);</div><div class="line"><span class="comment">// 第一种</span></div><div class="line">canvas.drawRect(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>,mPaint);</div><div class="line"></div><div class="line"><span class="comment">// 第二种</span></div><div class="line">Rect rect = <span class="keyword">new</span> Rect(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>);</div><div class="line">canvas.drawRect(rect,mPaint);</div><div class="line"></div><div class="line"><span class="comment">// 第三种</span></div><div class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>);</div><div class="line">canvas.drawRect(rectF,mPaint);</div><div class="line"><span class="comment">// 第一种</span></div><div class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>);</div><div class="line">canvas.drawRoundRect(rectF,<span class="number">30</span>,<span class="number">30</span>,mPaint);</div><div class="line"></div><div class="line"><span class="comment">// 第二种</span></div><div class="line">canvas.drawRoundRect(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>,<span class="number">30</span>,<span class="number">30</span>,mPaint);</div><div class="line"><span class="comment">// 矩形</span></div><div class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>);  </div><div class="line"></div><div class="line"><span class="comment">// 绘制背景矩形</span></div><div class="line">mPaint.setColor(Color.GRAY);</div><div class="line">canvas.drawRect(rectF,mPaint);</div><div class="line"></div><div class="line"><span class="comment">// 绘制圆角矩形</span></div><div class="line">mPaint.setColor(Color.BLUE);</div><div class="line">canvas.drawRoundRect(rectF,<span class="number">700</span>,<span class="number">400</span>,mPaint);</div><div class="line"><span class="comment">// 第一种</span></div><div class="line">RectF rectF = <span class="keyword">new</span> RectF(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>);</div><div class="line">canvas.drawOval(rectF,mPaint);</div><div class="line"></div><div class="line"><span class="comment">// 第二种</span></div><div class="line">canvas.drawOval(<span class="number">100</span>,<span class="number">100</span>,<span class="number">800</span>,<span class="number">400</span>,mPaint);</div><div class="line">canvas.drawCircle(<span class="number">500</span>,<span class="number">500</span>,<span class="number">400</span>,mPaint);  <span class="comment">// 绘制一个圆心坐标在(500,500)，半径为400 的圆。</span></div><div class="line"><span class="comment">// 第一种</span></div><div class="line"><span class="comment">//userCenter 是否使用中心</span></div><div class="line"><span class="comment">//false  画过的是弧区</span></div><div class="line"><span class="comment">//true  画过的是带圆心的半圆弧</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawArc</span><span class="params">(@NonNull RectF oval, <span class="keyword">float</span> startAngle, <span class="keyword">float</span> sweepAngle, <span class="keyword">boolean</span> useCenter, @NonNull Paint paint)</span></span>&#123;&#125;</div><div class="line">    </div><div class="line"><span class="comment">// 第二种</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawArc</span><span class="params">(<span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="keyword">float</span> right, <span class="keyword">float</span> bottom, <span class="keyword">float</span> startAngle,</span></span></div><div class="line">            <span class="keyword">float</span> sweepAngle, <span class="keyword">boolean</span> useCenter, @NonNull Paint paint) &#123;&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>绘制图片    drawBitmap, drawPicture    绘制位图和图片</p>
</li>
<li>绘制文本    drawText, drawPosText, drawTextOnPath    依次为 绘制文字、绘制文字时指定每个文字位置、根据路径绘制文字</li>
<li>绘制路径    drawPath    绘制路径，绘制贝塞尔曲线时也需要用到该函数<br>顶点操作    drawVertices, drawBitmapMesh    通过对顶点操作可以使图像形变，drawVertices直接对画布作用、 drawBitmapMesh只对绘制的Bitmap作用</li>
<li>画布剪裁    clipPath, clipRect    设置画布的显示区域</li>
<li>画布快照    save, restore, saveLayerXxx, restoreToCount, getSaveCount    依次为 保存当前状态、 回滚到上一次保存的状态、 保存图层状态、 回滚到指定状态、 获取保存次数</li>
<li>画布变换    translate, scale, rotate, skew    依次为 位移、缩放、 旋转、错切<br>Matrix(矩阵)    getMatrix, setMatrix, concat    实际上画布的位移，缩放等操作的都是图像矩阵Matrix， 只不过Matrix比较难以理解和使用，故封装了一些常用的方法。<h3 id="创建画布"><a href="#创建画布" class="headerlink" title="创建画布"></a>创建画布</h3>要想绘制内容，首先需要先创建一个画笔，如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.创建一个画笔</span></div><div class="line"><span class="keyword">private</span> Paint mPaint = <span class="keyword">new</span> Paint();</div><div class="line"></div><div class="line"><span class="comment">// 2.初始化画笔</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initPaint</span><span class="params">()</span> </span>&#123;</div><div class="line">	mPaint.setColor(Color.BLACK);       <span class="comment">//设置画笔颜色</span></div><div class="line">	mPaint.setStyle(Paint.Style.FILL);  <span class="comment">//设置画笔模式为填充</span></div><div class="line">	mPaint.setStrokeWidth(<span class="number">10f</span>);         <span class="comment">//设置画笔宽度为10px</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 3.在构造函数中初始化</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SloopView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">   <span class="keyword">super</span>(context, attrs);</div><div class="line">   initPaint();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h3><ol>
<li><p>位移(translate)<br>translate是坐标系的移动，可以为图形绘制选择一个合适的坐标系。 请注意，位移是基于当前位置移动，而不是每次基于屏幕左上角的(0,0)点移动，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mPaint.setColor(Color.BLACK);</div><div class="line">canvas.translate(<span class="number">200</span>,<span class="number">200</span>);</div><div class="line">canvas.drawCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,mPaint);</div><div class="line"></div><div class="line"><span class="comment">// 在坐标原点绘制一个蓝色圆形</span></div><div class="line">mPaint.setColor(Color.BLUE);</div><div class="line">canvas.translate(<span class="number">200</span>,<span class="number">200</span>); </div><div class="line">canvas.drawCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,mPaint);</div></pre></td></tr></table></figure>
</li>
<li><p>缩放(scale)<br>缩放提供了两个方法，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scale</span> <span class="params">(<span class="keyword">float</span> sx, <span class="keyword">float</span> sy)</span></span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">scale</span> <span class="params">(<span class="keyword">float</span> sx, <span class="keyword">float</span> sy, <span class="keyword">float</span> px, <span class="keyword">float</span> py)</span></div><div class="line"><span class="comment">// 将坐标系原点移动到画布正中心</span></div><div class="line">canvas.<span class="title">translate</span><span class="params">(mWidth / <span class="number">2</span>, mHeight / <span class="number">2</span>)</span>;</div><div class="line"></div><div class="line">RectF rect = <span class="keyword">new</span> RectF(<span class="number">0</span>,-<span class="number">400</span>,<span class="number">400</span>,<span class="number">0</span>);   <span class="comment">// 矩形区域</span></div><div class="line"></div><div class="line">mPaint.setColor(Color.BLACK);           <span class="comment">// 绘制黑色矩形</span></div><div class="line">canvas.drawRect(rect,mPaint);</div><div class="line"></div><div class="line">canvas.scale(<span class="number">0.5f</span>,<span class="number">0.5f</span>);                <span class="comment">// 画布缩放</span></div><div class="line"></div><div class="line">mPaint.setColor(Color.BLUE);            <span class="comment">// 绘制蓝色矩形</span></div><div class="line">canvas.drawRect(rect,mPaint);</div></pre></td></tr></table></figure>
</li>
<li><p>旋转(rotate)<br>旋转提供了两种方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span> <span class="params">(<span class="keyword">float</span> degrees)</span></span></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">rotate</span> <span class="params">(<span class="keyword">float</span> degrees, <span class="keyword">float</span> px, <span class="keyword">float</span> py)</span></div><div class="line">和缩放一样，第二种方法多出来的两个参数依旧是控制旋转中心点的。</div></pre></td></tr></table></figure>
</li>
</ol>
<p>默认的旋转中心依旧是坐标原点：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将坐标系原点移动到画布正中心</span></div><div class="line">canvas.translate(mWidth / <span class="number">2</span>, mHeight / <span class="number">2</span>);</div><div class="line">RectF rect = <span class="keyword">new</span> RectF(<span class="number">0</span>,-<span class="number">400</span>,<span class="number">400</span>,<span class="number">0</span>);   <span class="comment">// 矩形区域</span></div><div class="line">mPaint.setColor(Color.BLACK);           <span class="comment">// 绘制黑色矩形</span></div><div class="line">canvas.drawRect(rect,mPaint);</div><div class="line">canvas.rotate(<span class="number">180</span>);                     <span class="comment">// 旋转180度 &lt;-- 默认旋转中心为原点</span></div><div class="line">mPaint.setColor(Color.BLUE);            <span class="comment">// 绘制蓝色矩形</span></div><div class="line">canvas.drawRect(rect,mPaint);</div></pre></td></tr></table></figure></p>
<h3 id="drawBitmap"><a href="#drawBitmap" class="headerlink" title="drawBitmap"></a>drawBitmap</h3><p>通过BitmapFactory从不同位置获取Bitmap:<br>资源文件(drawable/mipmap/raw):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Bitmap bitmap = BitmapFactory.decodeResource(mContext.getResources(),R.raw.bitmap);</div></pre></td></tr></table></figure></p>
<p>资源文件(assets):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Bitmap bitmap=<span class="keyword">null</span>;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    InputStream is = mContext.getAssets().open(<span class="string">"bitmap.png"</span>);</div><div class="line">    bitmap = BitmapFactory.decodeStream(is);</div><div class="line">    is.close();</div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>内存卡文件:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Bitmap bitmap = BitmapFactory.decodeFile(<span class="string">"/sdcard/bitmap.png"</span>);</div></pre></td></tr></table></figure></p>
<p>网络文件:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 此处省略了获取网络输入流的代码</span></div><div class="line">Bitmap bitmap = BitmapFactory.decodeStream(is);</div><div class="line">is.close();</div></pre></td></tr></table></figure></p>
<p>既然已经获得到了Bitmap，那么就开始本文的重点了，将Bitmap绘制到画布上。<br>绘制Bitmap：<br>依照惯例先预览一下drawBitmap的常用方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 第一种</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawBitmap</span> <span class="params">(Bitmap bitmap, Matrix matrix, Paint paint)</span></span></div><div class="line"></div><div class="line"><span class="comment">// 第二种</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawBitmap</span> <span class="params">(Bitmap bitmap, <span class="keyword">float</span> left, <span class="keyword">float</span> top, Paint paint)</span></div><div class="line"></div><div class="line"><span class="comment">// 第三种</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawBitmap</span> <span class="params">(Bitmap bitmap, Rect src, Rect dst, Paint paint)</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawBitmap</span> <span class="params">(Bitmap bitmap, Rect src, RectF dst, Paint paint)</span></div><div class="line">第一种方法中后两个参数<span class="params">(matrix, paint)</span>是在绘制的时候对图片进行一些改变，如果只是需要将图片内容绘制出来只需要如下操作就可以了：</div><div class="line">canvas.<span class="title">drawBitmap</span><span class="params">(bitmap,<span class="number">200</span>,<span class="number">500</span>,new Paint()</span>);</div><div class="line"><span class="comment">// 将画布坐标系移动到画布中央</span></div><div class="line">canvas.translate(mWidth/<span class="number">2</span>,mHeight/<span class="number">2</span>);</div><div class="line"></div><div class="line"><span class="comment">// 指定图片绘制区域(左上角的四分之一)</span></div><div class="line">Rect src = <span class="keyword">new</span> Rect(<span class="number">0</span>,<span class="number">0</span>,bitmap.getWidth()/<span class="number">2</span>,bitmap.getHeight()/<span class="number">2</span>);</div><div class="line"><span class="comment">// 指定图片在屏幕上显示的区域</span></div><div class="line">Rect dst = <span class="keyword">new</span> Rect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">200</span>,<span class="number">400</span>);</div><div class="line"><span class="comment">// 绘制图片</span></div><div class="line">canvas.drawBitmap(bitmap,src,dst,<span class="keyword">null</span>);</div></pre></td></tr></table></figure></p>
<h3 id="绘制文本"><a href="#绘制文本" class="headerlink" title="绘制文本"></a>绘制文本</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 第一类</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawText</span> <span class="params">(String text, <span class="keyword">float</span> x, <span class="keyword">float</span> y, Paint paint)</span></span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawText</span> <span class="params">(String text, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">float</span> x, <span class="keyword">float</span> y, Paint paint)</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawText</span> <span class="params">(CharSequence text, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">float</span> x, <span class="keyword">float</span> y, Paint paint)</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawText</span> <span class="params">(<span class="keyword">char</span>[] text, <span class="keyword">int</span> index, <span class="keyword">int</span> count, <span class="keyword">float</span> x, <span class="keyword">float</span> y, Paint paint)</span></div><div class="line"></div><div class="line"><span class="comment">// 第二类</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawPosText</span> <span class="params">(String text, <span class="keyword">float</span>[] pos, Paint paint)</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawPosText</span> <span class="params">(<span class="keyword">char</span>[] text, <span class="keyword">int</span> index, <span class="keyword">int</span> count, <span class="keyword">float</span>[] pos, Paint paint)</span></div><div class="line"></div><div class="line"><span class="comment">// 第三类</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawTextOnPath</span> <span class="params">(String text, Path path, <span class="keyword">float</span> hOffset, <span class="keyword">float</span> vOffset, Paint paint)</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawTextOnPath</span> <span class="params">(<span class="keyword">char</span>[] text, <span class="keyword">int</span> index, <span class="keyword">int</span> count, Path path, <span class="keyword">float</span> hOffset, <span class="keyword">float</span> vOffset, Paint paint)</span></div></pre></td></tr></table></figure>
<h3 id="drawText"><a href="#drawText" class="headerlink" title="drawText()"></a>drawText()</h3><p><code>drawText(String text, float x, float y, Paint paint)</code><br>drawText() 是 Canvas 最基本的绘制文字的方法：给出文字的内容和位置， Canvas 按要求去绘制文字。<br>text 是文字内容，x 和 y 是文字的坐标。但需要注意：这个坐标并不是文字的左上角，而是一个与左下角比较接近的位置。大概在这里：<br><img src="Android-CustomView%20%20Canvas/BB64E71A-8C63-41BE-962A-17550C49E0E2.png" alt=""><br>参数Y  时基线(baseline)</p>
<h3 id="drawTextOnPath"><a href="#drawTextOnPath" class="headerlink" title="drawTextOnPath()"></a>drawTextOnPath()</h3><p>沿着一条 Path 来绘制文字。这是一个耍杂技的方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">canvas.drawPath(path, paint); <span class="comment">// 把 Path 也绘制出来，理解起来更方便  </span></div><div class="line">canvas.drawTextOnPath(<span class="string">"Hello HeCoder"</span>, path, <span class="number">0</span>, <span class="number">0</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="StaticLayout"><a href="#StaticLayout" class="headerlink" title="StaticLayout"></a>StaticLayout</h3><p>Canvas.drawText() 只能绘制单行的文字，而不能换行。它：</p>
<ul>
<li>不能在 View 的边缘自动折行</li>
<li>不能在换行符 \n 处换行<br>理解：<blockquote>
<p>StaticLayout 并不是一个 View 或者 ViewGroup ，而是 android.text.Layout 的子类，它是纯粹用来绘制文字的。 StaticLayout 支持换行，它既可以为文字设置宽度上限来让文字自动换行，也会在 \n 处主动换行。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">StaticLayout 的构造方法是 StaticLayout(CharSequence source, TextPaint paint, <span class="keyword">int</span> width, Layout.Alignment align, <span class="keyword">float</span> spacingmult, <span class="keyword">float</span> spacingadd, <span class="keyword">boolean</span> includepad)，其中参数里：</div><div class="line"></div><div class="line">width 是文字区域的宽度，文字到达这个宽度后就会自动换行； </div><div class="line">align 是文字的对齐方向； </div><div class="line">spacingmult 是行间距的倍数，通常情况下填 <span class="number">1</span> 就好； </div><div class="line">spacingadd 是行间距的额外增加值，通常情况下填 <span class="number">0</span> 就好； </div><div class="line">includeadd 是指是否在文字上下添加额外的空间，来避免某些过高的字符的绘制出现越界。</div></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h3 id="setTextSize-float-textSize"><a href="#setTextSize-float-textSize" class="headerlink" title="setTextSize(float textSize)"></a>setTextSize(float textSize)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">paint.setTextSize(<span class="number">18</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">25</span>, paint);  </div><div class="line">paint.setTextSize(<span class="number">36</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">70</span>, paint);  </div><div class="line">paint.setTextSize(<span class="number">60</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">145</span>, paint);  </div><div class="line">paint.setTextSize(<span class="number">84</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">240</span>, paint);</div></pre></td></tr></table></figure>
<h3 id="setTypeface-Typeface-typeface"><a href="#setTypeface-Typeface-typeface" class="headerlink" title="setTypeface(Typeface typeface)"></a>setTypeface(Typeface typeface)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> paint.setTypeface(Typeface.DEFAULT);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">150</span>, paint);  </div><div class="line">paint.setTypeface(Typeface.SERIF);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">300</span>, paint);  </div><div class="line">paint.setTypeface(Typeface.createFromAsset(getContext().getAssets(), <span class="string">"Satisfy-Regular.ttf"</span>));  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">450</span>, paint);</div></pre></td></tr></table></figure>
<h3 id="setFakeBoldText-boolean-fakeBoldText"><a href="#setFakeBoldText-boolean-fakeBoldText" class="headerlink" title="setFakeBoldText(boolean fakeBoldText)"></a>setFakeBoldText(boolean fakeBoldText)</h3><p>是否使用伪粗体。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">paint.setFakeBoldText(<span class="keyword">false</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">150</span>, paint);  </div><div class="line">paint.setFakeBoldText(<span class="keyword">true</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">230</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="setStrikeThruText-boolean-strikeThruText"><a href="#setStrikeThruText-boolean-strikeThruText" class="headerlink" title="setStrikeThruText(boolean strikeThruText)"></a>setStrikeThruText(boolean strikeThruText)</h3><p>是否加删除线。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">paint.setStrikeThruText(<span class="keyword">true</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">150</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="setUnderlineText-boolean-underlineText"><a href="#setUnderlineText-boolean-underlineText" class="headerlink" title="setUnderlineText(boolean underlineText)"></a>setUnderlineText(boolean underlineText)</h3><p>是否加下划线。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">paint.setUnderlineText(<span class="keyword">true</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">150</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="setTextSkewX-float-skewX"><a href="#setTextSkewX-float-skewX" class="headerlink" title="setTextSkewX(float skewX)"></a>setTextSkewX(float skewX)</h3><p>设置文字横向错切角度。其实就是文字倾斜度的啦。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">paint.setTextSkewX(-<span class="number">0.5f</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">150</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="setLetterSpacing-float-letterSpacing"><a href="#setLetterSpacing-float-letterSpacing" class="headerlink" title="setLetterSpacing(float letterSpacing)"></a>setLetterSpacing(float letterSpacing)</h3><p>设置字符间距。默认值是 0。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">paint.setLetterSpacing(<span class="number">0.2f</span>);  </div><div class="line">canvas.drawText(text, <span class="number">100</span>, <span class="number">150</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="setTextAlign-Paint-Align-align"><a href="#setTextAlign-Paint-Align-align" class="headerlink" title="setTextAlign(Paint.Align align)"></a>setTextAlign(Paint.Align align)</h3><p> 设置文字的对齐方式。一共有三个值：LEFT CETNER 和 RIGHT。默认值为 LEFT。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">paint.setTextAlign(Paint.Align.LEFT);  </div><div class="line">canvas.drawText(text, <span class="number">500</span>, <span class="number">150</span>, paint);  </div><div class="line">paint.setTextAlign(Paint.Align.CENTER);  </div><div class="line">canvas.drawText(text, <span class="number">500</span>, <span class="number">150</span> + textHeight, paint);  </div><div class="line">paint.setTextAlign(Paint.Align.RIGHT);  </div><div class="line">canvas.drawText(text, <span class="number">500</span>, <span class="number">150</span> + textHeight * <span class="number">2</span>, paint);</div></pre></td></tr></table></figure></p>
<h3 id="范围裁切"><a href="#范围裁切" class="headerlink" title="范围裁切"></a>范围裁切</h3><p>Canvas.translate(float dx, float dy) 平移<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">anvas.clipRect(left, top, right, bottom);  </div><div class="line">canvas.drawBitmap(bitmap, x, y, paint);</div></pre></td></tr></table></figure></p>
<p>Canvas.save() 和 Canvas.restore() 来及时恢复绘制范围，所以完整代码是这样的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">canvas.save();  </div><div class="line">canvas.clipRect(left, top, right, bottom);  </div><div class="line">canvas.drawBitmap(bitmap, x, y, paint);  </div><div class="line">canvas.restore();</div></pre></td></tr></table></figure></p>
<h3 id="几何变化"><a href="#几何变化" class="headerlink" title="几何变化"></a>几何变化</h3><ol>
<li><p>Canvas.translate(float dx, float dy) 平移</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">canvas.save();  </div><div class="line">canvas.translate(<span class="number">200</span>, <span class="number">0</span>);  </div><div class="line">canvas.drawBitmap(bitmap, x, y, paint);  </div><div class="line">canvas.restore();</div></pre></td></tr></table></figure>
</li>
<li><p>Canvas.rotate(float degrees, float px, float py) 旋转<br>参数里的 degrees 是旋转角度，单位是度（也就是一周有 360° 的那个单位），方向是顺时针为正向；  px 和 py 是轴心的位置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">canvas.save();  </div><div class="line">canvas.rotate(<span class="number">45</span>, centerX, centerY);  </div><div class="line">canvas.drawBitmap(bitmap, x, y, paint);  </div><div class="line">canvas.restore();</div></pre></td></tr></table></figure>
</li>
<li><p>Canvas.scale(float sx, float sy, float px, float py) 放缩<br>参数里的 sx sy 是横向和纵向的放缩倍数； px py 是放缩的轴心。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">canvas.save();  </div><div class="line">canvas.scale(<span class="number">1.3f</span>, <span class="number">1.3f</span>, x + bitmapWidth / <span class="number">2</span>, y + bitmapHeight / <span class="number">2</span>);  </div><div class="line">canvas.drawBitmap(bitmap, x, y, paint);  </div><div class="line">canvas.restore();</div></pre></td></tr></table></figure>
</li>
<li><p>skew(float sx, float sy) 错切<br>参数里的 sx 和 sy 是 x 方向和 y 方向的错切系数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">canvas.save();  </div><div class="line">canvas.skew(<span class="number">0</span>, <span class="number">0.5f</span>);  </div><div class="line">canvas.drawBitmap(bitmap, x, y, paint);  </div><div class="line">canvas.restore();</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用-Matrix-来做常见变换"><a href="#使用-Matrix-来做常见变换" class="headerlink" title="使用 Matrix 来做常见变换"></a>使用 Matrix 来做常见变换</h3><p>Matrix 做常见变换的方式：</p>
<ol>
<li>创建 Matrix 对象；</li>
<li>调用 Matrix 的 pre/postTranslate/Rotate/Scale/Skew() 方法来设置几何变换；</li>
<li>使用 Canvas.setMatrix(matrix) 或 Canvas.concat(matrix) 来把几何变换应用到 Canvas。<h3 id="super-onDraw-canvas"><a href="#super-onDraw-canvas" class="headerlink" title="super.onDraw(canvas);"></a>super.onDraw(canvas);</h3>这个方法是空<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/ 在 View.java 的源码中，onDraw() 是空的</div><div class="line"><span class="comment">// 所以直接继承 View 的类，它们的 super.onDraw() 什么也不会做</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> <span class="keyword">implements</span> <span class="title">Drawable</span>.<span class="title">Callback</span>,  </span></div><div class="line">        <span class="title">KeyEvent</span>.<span class="title">Callback</span>, <span class="title">AccessibilityEventSource</span> &#123;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Implement this to do your drawing.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> canvas the canvas on which the background will be drawn</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>### </p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/09/11/Android-图片加载库Glide/" class="prev">PREV</a><a href="/2019/04/22/Android-沉浸式状态栏/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2020 <a href="http://yoursite.com">dangxy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>